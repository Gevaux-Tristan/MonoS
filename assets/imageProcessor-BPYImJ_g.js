const m=(n,o)=>{for(let t=0;t<n.length;t+=4096){const i=Math.min(t+4096,n.length);for(let e=t;e<i;e+=4){const c=n[e]*76+n[e+1]*150+n[e+2]*29>>8;let r=c+(o.brightness*c>>7);if(r=128+((r-128)*(o.contrast+100)>>7),o.grain>0&&(e&15||(r+=(Math.random()*2-1)*o.grain)),r=r<0?0:r>255?255:r,o.tint){const s=o.tint.intensity/100,p=parseInt(o.tint.color.slice(1,3),16),f=parseInt(o.tint.color.slice(3,5),16),a=parseInt(o.tint.color.slice(5,7),16),l=1-s;n[e]=r*l+p*s,n[e+1]=r*l+f*s,n[e+2]=r*l+a*s}else n[e]=n[e+1]=n[e+2]=r;n[e+3]=255}}return n};self.onmessage=n=>{const{imageData:o,settings:h,width:t,height:i}=n.data,e=new Uint8ClampedArray(o.data),c=m(e,h);self.postMessage({processedData:Array.from(c),width:t,height:i})};
